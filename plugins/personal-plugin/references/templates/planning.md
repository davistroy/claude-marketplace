<!-- ============================================================
     PLANNING COMMAND TEMPLATE

     Canonical Section Order:
     1. Frontmatter (description, allowed-tools)
     2. Title (# Command Name)
     3. Brief description paragraph
     4. Input Validation (optional for planning)
     5. Instructions (analysis + document generation phases)
     6. Output Format (required - generates planning documents)
     7. Examples
     8. Performance (required for analysis-heavy commands)

     Pattern References:
     - Naming: references/patterns/naming.md
     - Validation: references/patterns/validation.md (severity levels)
     - Output: references/patterns/output.md (document templates)
     - Logging: references/patterns/logging.md (performance expectations)

     Note: Planning commands ANALYZE and GENERATE planning documents
     ============================================================ -->

<!-- SECTION 1: FRONTMATTER -->
---
description: {{DESCRIPTION}}
---

<!-- SECTION 2: TITLE -->
# {{TITLE}}

<!-- SECTION 3: BRIEF DESCRIPTION -->
{{INTRO_PARAGRAPH}}

<!-- SECTION 4: INPUT VALIDATION (optional for planning) -->
## Input Validation

**Optional Arguments:**
- `<scope>` - Specific scope to analyze (default: entire project)
- `--focus <area>` - Focus analysis on specific area
- `--quick` - Generate abbreviated plan (skip deep analysis)

**Validation:**
If specified scope is not found, display:
```
Error: Scope '[name]' not found.

Available scopes:
  - [list available scopes]

Example: /{{COMMAND_NAME}} src/
Example: /{{COMMAND_NAME}} --focus performance
```

See `references/patterns/validation.md` for error message format.

<!-- SECTION 5: INSTRUCTIONS -->
## Instructions

### Phase 1: Deep Analysis (Ultrathink)

Thoroughly analyze the target scope with extended thinking enabled. Focus on:

#### [Assessment Area 1]
- [Analysis point 1]
- [Analysis point 2]
- [Analysis point 3]
- [Analysis point 4]
- [Analysis point 5]

#### [Assessment Area 2]
- [Analysis point 1]
- [Analysis point 2]
- [Analysis point 3]
- [Analysis point 4]
- [Analysis point 5]

#### [Assessment Area 3]
- [Analysis point 1]
- [Analysis point 2]
- [Analysis point 3]
- [Analysis point 4]
- [Analysis point 5]

#### [Assessment Area 4]
- [Analysis point 1]
- [Analysis point 2]
- [Analysis point 3]

#### [Assessment Area 5]
- [Analysis point 1]
- [Analysis point 2]
- [Analysis point 3]

### Phase 2: Generate Recommendations Document

Create a comprehensive recommendations document with this structure:

```markdown
# [Recommendations Title]

**Generated:** [timestamp]
**Analyzed Scope:** [scope name/path]

---

## Executive Summary

[2-3 paragraph overview of key findings and highest-impact recommendations]

---

## Recommendation Categories

### Category 1: [Category Name]

#### [ID]1. [Recommendation Title]

**Priority:** Critical | High | Medium | Low
**Effort:** XS | S | M | L | XL
**Impact:** [Description of benefit]

**Current State:**
[What exists now and why it's problematic]

**Recommendation:**
[Specific, actionable improvement]

**Implementation Notes:**
[Technical considerations, dependencies, risks]

---

### Category 2: [Category Name]
...

---

## Quick Wins

[List of low-effort, high-impact items that can be done immediately]

---

## Strategic Initiatives

[List of larger changes that require planning]

---

## Not Recommended

[Items considered but rejected, with rationale - prevents revisiting]

---

*Recommendations generated by Claude on [timestamp]*
```

### Phase 3: Generate Implementation Plan

Transform recommendations into an actionable, phased implementation plan:

```markdown
# Implementation Plan

**Generated:** [timestamp]
**Based On:** [recommendations document]
**Total Phases:** [N]

---

## Plan Overview

[Summary of the implementation strategy and phasing rationale]

### Phase Summary Table

| Phase | Focus Area | Key Deliverables | Est. Effort | Dependencies |
|-------|------------|------------------|-------------|--------------|
| 1 | [Area] | [Deliverables] | ~X hours | None |
| 2 | [Area] | [Deliverables] | ~X hours | Phase 1 |
| ... | ... | ... | ... | ... |

---

## Phase 1: [Phase Title]

**Estimated Effort:** [X hours/days]
**Dependencies:** [None | List of phases]
**Parallelizable:** [Yes/No - can work items run concurrently]

### Goals
- [Goal 1]
- [Goal 2]

### Work Items

#### 1.1 [Task Title]
**Recommendation Ref:** [ID from recommendations]
**Files Affected:** [List of files]
**Description:**
[Detailed task description]

**Acceptance Criteria:**
- [ ] [Criterion 1]
- [ ] [Criterion 2]

---

## Parallel Work Opportunities

[Identify which phases or work items can be executed concurrently]

---

## Risk Mitigation

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| [Risk 1] | Low/Med/High | Low/Med/High | [Strategy] |

---

## Success Metrics

[How to measure overall success of the implementation]

---

*Implementation plan generated by Claude on [timestamp]*
```

### Phase Sizing Guidelines

Each phase should:
- Have clear boundaries and deliverables
- Be independently testable
- Not leave the project in a broken state if stopped mid-plan
- Enable parallel work where possible

### Phase 4: Save and Report

1. **Ensure output directory exists**:
   ```bash
   mkdir -p {{OUTPUT_LOCATION}}
   ```

2. Save recommendations document to repository root or {{OUTPUT_LOCATION}}
3. Save implementation plan to repository root or {{OUTPUT_LOCATION}}
4. Report summary to user

<!-- SECTION 6: OUTPUT FORMAT -->
## Output Format

**Primary Output Files:**
- `{{RECOMMENDATIONS_FILE}}` - Detailed recommendations
- `{{PLAN_FILE}}` - Phased implementation plan

See `references/patterns/naming.md` for naming conventions.

**Location:** Repository root or `{{OUTPUT_LOCATION}}`

### Completion Summary

```
Analysis complete.

**{{RECOMMENDATIONS_FILE}} created** with X recommendations across Y categories:
- [Category 1]: N (priority breakdown)
- [Category 2]: N (priority breakdown)
...

**{{PLAN_FILE}} created** with N phases:
- Phase 1: [Focus] (~X effort)
- Phase 2: [Focus] (~X effort)
...

**Top 3 Highest-Impact Recommendations:**
1. [ID] [Title]
2. [ID] [Title]
3. [ID] [Title]

**Suggested Starting Point:** [Phase/Item recommendation]

Files saved:
- {{RECOMMENDATIONS_FILE}}
- {{PLAN_FILE}}
```

See `references/patterns/output.md` for completion summary format.

<!-- SECTION 7: EXAMPLES -->
## Examples

### Basic Usage

```
User: /{{COMMAND_NAME}}

Claude: [Performs deep analysis of the project]

I've completed the analysis for [project].

**{{RECOMMENDATIONS_FILE}} created** with 23 recommendations across 5 categories:
- [Category 1]: 6 (2 Critical, 2 High, 2 Medium)
- [Category 2]: 4 (1 High, 3 Medium)
- [Category 3]: 5 (1 Critical, 2 High, 2 Medium)
- [Category 4]: 4 (2 High, 2 Low)
- [Category 5]: 4 (1 High, 2 Medium, 1 Low)

**{{PLAN_FILE}} created** with 4 phases:
- Phase 1: Foundation (~2 days) - Critical fixes and quick wins
- Phase 2: Quality (~3 days) - Output improvements
- Phase 3: Architecture (~4 days) - Structural refactoring
- Phase 4: Features (~3 days) - New capabilities

**Top 3 Highest-Impact Recommendations:**
1. [A1] Standardize validation framework
2. [U2] Add interactive parameter prompting
3. [Q1] Implement output template system

**Suggested Starting Point:** Phase 1, Item 1.1 - addresses critical stability issue

Files saved:
- {{RECOMMENDATIONS_FILE}}
- {{PLAN_FILE}}
```

### With Focused Scope

```
User: /{{COMMAND_NAME}} --focus performance

Claude: Focusing analysis on performance-related areas...

[Analysis proceeds with performance focus]

**{{RECOMMENDATIONS_FILE}} created** with 8 performance recommendations...
```

### Quick Mode

```
User: /{{COMMAND_NAME}} --quick

Claude: Running abbreviated analysis...

[Abbreviated analysis with essential recommendations only]

**{{RECOMMENDATIONS_FILE}} created** with 10 high-priority recommendations...
**{{PLAN_FILE}} created** with 2 phases...
```

<!-- SECTION 8: PERFORMANCE -->
## Performance

**Typical Duration:**

| Scope Size | Expected Time |
|------------|---------------|
| Small (< 50 files) | 1-2 minutes |
| Medium (50-200 files) | 3-5 minutes |
| Large (200-500 files) | 5-10 minutes |
| Very Large (500+ files) | 10-20 minutes |

**Factors Affecting Performance:**
- **File count**: More files = longer analysis
- **Code complexity**: Complex interdependencies slow pattern detection
- **Language diversity**: Multiple languages require broader analysis
- **Documentation depth**: Comprehensive recommendations take longer to formulate

**Signs of Abnormal Behavior:**
- No output activity after 5 minutes
- Repeated file reading without progress
- Error messages about file access

**If the command seems stuck:**
1. Check for output activity (phase progress indicators)
2. Wait at least 10 minutes for large scopes
3. If no activity, interrupt and try `--quick` mode
4. Consider breaking into smaller scope (specific directories)

See `references/patterns/logging.md` for performance documentation pattern.

## Execution Guidelines

- **Be thorough**: This analysis informs significant work - miss nothing important
- **Be specific**: Vague recommendations waste time; include file paths, concrete approaches
- **Be realistic**: Estimate effort honestly; overrunning phases causes problems
- **Be practical**: Prioritize impact over elegance; ship value to users
- **Consider context**: Factor in the project's maturity, goals, and constraints
- **Enable parallelism**: Structure phases so multiple streams can work simultaneously when possible
- **Preserve stability**: Each phase should leave the project in a working state

Begin analysis by gathering context, then present an executive summary before detailed findings.
