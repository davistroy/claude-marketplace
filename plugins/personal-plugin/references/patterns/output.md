# Output Patterns

This document defines patterns for generating output files, creating directories, and previewing results.

## Directory Auto-Creation

Commands MUST automatically create output directories if they don't exist before writing files. Use the following pattern:

```bash
# Ensure output directory exists before writing
mkdir -p reports/  # or reference/, .tmp/, etc.
```

This ensures commands work correctly in fresh repositories or when output directories have been cleaned up.

## Output Preview Mode

Commands generating structured output SHOULD support the `--preview` flag to allow users to review and confirm before saving.

### Preview Pattern

When `--preview` is specified:

1. **Generate output in memory** - Create the complete output structure
2. **Validate against schema** - Check all required fields and types
3. **Display summary** - Show a compact summary, not the full output:
   ```
   Preview: /define-questions
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   Source: PRD.md
   Questions found: 15

   By topic:
     Technical Architecture: 5
     User Experience: 3
     Data Model: 7

   Schema validation: PASSED
   Output file: questions-PRD-20260114-143052.json
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   Save this file? (y/n):
   ```
4. **Wait for confirmation** - Only save on explicit 'y' or 'yes'
5. **On rejection** - Display message and exit without saving

### Preview vs Dry-Run

| Flag | Purpose | Behavior |
|------|---------|----------|
| `--preview` | Review output before saving | Generates output, shows summary, asks confirmation |
| `--dry-run` | Test without any side effects | Shows what would happen, never executes |

### Commands Supporting Preview

| Command | Output Type | Preview Summary |
|---------|-------------|-----------------|
| `/define-questions` | JSON | Question count, topics, validation status |
| `/analyze-transcript` | MD/JSON | Section count, action items, decisions |
| `/bpmn-generator` | BPMN XML | Element counts, lanes, validation status |

### Implementation Requirements

Commands implementing `--preview` MUST:
1. Document the `--preview` flag in their Input Validation section
2. Generate complete output before showing preview (not partial)
3. Show validation status in the preview summary
4. Require explicit user confirmation before saving
5. Handle 'n' response gracefully (no error, just exit)

## Completion Summaries

All commands generating output SHOULD end with a standardized completion summary:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[Command Name] Complete
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

**Summary:**
- [Metric 1]: [Value]
- [Metric 2]: [Value]

**Output:**
- [File path or result]

**Next Steps:**
- [Suggested action 1]
- [Suggested action 2]
```

## Confirmation Prompts

For destructive or irreversible actions:

```
Warning: This will [describe action].

Affected items:
- [Item 1]
- [Item 2]

Type 'confirm' to proceed or 'cancel' to abort:
```

## Progress Reporting

```
Phase X of Y: [Phase Name]
- Step 1: [Description] (completed)
- Step 2: [Description] (in progress)
- Step 3: [Description] (pending)
```

## Output File Structure

### JSON Output Structure

Standard structure for JSON output files:

```json
{
  "items": [...],
  "metadata": {
    "source_document": "Name of input",
    "total_items": 0,
    "generated_date": "ISO date string",
    "command": "/command-name",
    "version": "1.0.0"
  }
}
```

### Markdown Output Structure

Standard structure for markdown reports:

```markdown
# Report Title

**Generated:** [ISO timestamp]
**Source:** [Input file or description]

## Executive Summary

[Brief overview]

## Detailed Findings

### Section 1
...

### Section 2
...

## Recommendations

1. [Action item]
2. [Action item]

---
*Generated by /command-name*
```
